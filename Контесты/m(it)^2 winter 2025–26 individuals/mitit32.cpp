// author: bjcb
//m(it)^2 2025 
/*
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣀⣀⣀⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⢀⣤⣶⣾⡟⣯⣽⣻⣿⣿⣿⣷⣦⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⣀⣴⣿⢻⣿⣿⢻⣿⣷⣿⣿⣿⣿⣿⣿⣿⣷⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⣀⣴⣿⣿⣏⣿⣿⣿⡈⢻⣽⣿⣿⣾⣿⣿⣿⣿⣿⣿⣷⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⢀⣴⣿⣿⣿⣿⢾⣿⣿⣿⣇⠀⠻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⢀⣴⠿⠿⠿⢿⣿⣿⣿⣿⣿⢻⢻⣄⠀⠈⠻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⠷⠄⠀⠀⠀⠀⠀⠀⠀⠀
⠉⠀⠀⠀⠀⢸⣿⣿⣿⣿⢹⣒⠢⣿⣄⠀⠀⠚⢻⣿⣿⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⣿⡏⣿⣿⡟⣿⣿⡮⠈⠀⠀⠰⣿⣿⠻⣿⣿⣧⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⣿⣿⣼⣿⣇⠉⠋⠀⠀⡀⠀⠀⠉⠉⢀⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣄⠀⠀⢀⣉⡀⠀⠀⣠⣿⣿⣿⣿⣷⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣷⡦⣀⣀⣀⢴⣿⣿⣿⣿⣿⣿⣿⡟⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⢿⣿⣿⣿⣿⣿⣿⡇⠀⠀⠀⠸⣿⣿⣿⣿⣿⣿⣿⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⣸⠿⢿⣿⣿⠛⠉⠀⠀⠀⠀⠀⠙⠛⢿⣿⡿⠿⣿⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⢀⠎⠀⠀⣎⣿⣿⡂⠒⠒⢢⣤⣖⣛⣉⣁⣼⣿⡇⠀⠈⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⣼⢀⠀⠀⠇⢹⣿⡍⡉⣹⣿⣧⠀⠀⠀⠀⣾⣿⣇⢀⠀⢰⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⢿⠀⢧⣀⡇⠘⣿⡇⠀⠉⢹⣧⡀⠀⠁⠈⣿⡿⢹⠎⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⢸⠀⠀⢻⢆⠀⢿⡇⠀⠀⢸⡇⠻⣆⠀⢰⣿⠃⣺⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⡄⠀⢸⡄⠃⡈⣿⡀⠀⢨⢸⡦⢻⣧⣽⠿⢰⢿⠀⠀⢸⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⡅⠀⠸⡛⡄⠈⠹⠁⠀⢸⠈⣧⠀⠹⣏⢠⠇⢸⠀⠀⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⢁⠀⠀⡇⠹⣥⠀⢡⠀⢸⠀⢸⡆⠀⢹⡟⠀⢸⠀⠀⢸⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⢰⠀⠀⣿⠀⠈⠄⠀⢡⠀⠀⠀⣧⠀⠀⢻⠀⢸⠀⠀⢸⣿⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠈⡄⠀⣿⠀⠀⢠⠀⠀⢣⡄⠀⢽⠀⠀⢉⣧⣿⠀⠀⣼⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⢇⠀⣿⠀⠀⠀⠄⠀⠀⠃⠂⢸⡇⠠⠃⢛⣿⠀⠀⣿⣿⣷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⢸⢠⣿⠀⠀⠀⠀⠀⠀⠈⢢⡘⠃⠀⢰⠈⣿⠶⠒⠿⣿⣿⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠈⠿⠘⠀⠀⠀⠀⡄⠀⠀⠈⠋⠢⠄⠈⢆⢻⠀⠀⠐⢌⢻⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠃⠀⠀⠀⠀⠀⠠⠀⠀⠀⠀⠀⠈⠁⠈⢻⣦⡭⣍⠢⣽⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⡜⠀⠀⠀⠀⠀⠀⠀⠁⠀⠀⠀⠀⠀⠀⠀⠀⢻⠹⣦⣷⣽⣿⡆⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⢀⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⣷⣿⣿⣿⣿⣇⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⡄⠀⢰⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢻⣿⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⡆⠀⠘⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠰⠀⠀⠀⠸⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⢸⠁⠀⢠⡇⠀⠀⠀⠀⠀⠀⠀⠈⡆⠀⠀⠀⠀⢣⠀⠀⠀⢿⣿⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⢸⠀⠀⠘⣼⠀⠀⠀⡄⠀⠀⠀⠀⢀⠀⠀⠀⠀⠀⢃⠀⠀⢸⣿⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⣿⠀⠀⠀⠘⡆⠀⠀⠰⠀⠀⠀⠀⠈⡄⠀⠀⠀⠀⠈⡆⠀⠀⣿⣿⣿⣿⣿⡀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⡟⠀⠀⠀⠀⢡⠀⠀⠀⢃⠀⠀⠀⠀⢣⠀⠀⠀⠀⠀⠘⡄⠀⢸⣿⣿⣿⣿⣇⠀⠀⠀⠀⠀
⠀⠀⠀⠀⡇⠀⠀⠀⠀⠈⡄⠀⠀⠀⢆⠀⠀⠀⠘⡀⠀⠀⠀⠀⠀⢹⠀⠀⢿⣿⣿⣿⣿⡄⠀⠀⠀⠀
⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⠘⠀⠀⠀⠈⢂⠀⠀⠀⢃⠀⠀⠀⠀⠀⠀⣇⢸⠘⣿⣿⣿⣿⣇⠀⠀⠀⠀
⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣤⠀⠀⠀⠀⠀⠘⡆⡆⢹⣿⣿⣿⣿⠀⠀⠀⠀
⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⠠⢱⣷⠘⣿⣿⣿⣿⡇⠀⠀⠀
⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢱⠀⠀⠀⠀⠀⠀⠈⠀⢀⢹⣿⣿⣿⣿⠀⠀⠀
⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠨⡄⠀⠀⠀⠀⠀⠀⠀⢐⣿⣿⣿⣿⣿⡆⠀⠀
⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⠀⠀⠀⠀⠀⢀⠀⠀⢸⣿⣿⣿⣿⡇⠀⠀
⠀⠀⠀⠀⠣⠀⡀⠀⡀⠀⠀⠀⠀⣀⡀⣀⣀⣀⣀⣀⣀⣀⣆⣀⣠⣈⣴⣧⣿⣿⣿⣾⣿⡇⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⢿⠉⠉⠉⠉⠁⠉⡍⠀⠈⡇⠀⠀⠀⠀⠀⠀⡿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠸⡙⠶⢄⣀⠀⠀⢣⠀⠀⡇⠀⠀⠀⠀⠀⢸⠃⣿⣿⣿⣾⣿⣿⣿⣿⣿⣇⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠇⠀⠀⠀⠈⠉⢹⠀⠀⡇⠒⠂⠐⠒⠉⢸⢹⣿⣿⣿⣾⢿⣿⣿⣿⣿⣿⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠈⡆⠀⡇⠀⠀⠀⠀⠀⢸⢸⣿⣿⣿⣯⣿⣿⣿⣿⣿⣿⡄⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⡄⠀⠀⠀⠀⠀⡇⠀⠃⠀⠀⠀⠀⠀⡞⠈⣿⣿⣿⣿⣽⣿⣿⣿⣿⣿⡇⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⣷⠀⢠⠀⠀⠀⠀⠀⡇⠀⢸⣿⣿⣯⣷⣿⣿⣿⣿⣿⡇⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⢸⠀⠀⠀⢠⢿⠀⢸⢠⠀⠀⠀⡖⡇⠀⠀⢿⣿⣿⣿⣿⣿⣿⡟⢻⣿⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠞⠀⡖⠀⡎⣸⠀⠸⠀⠇⠀⢀⠁⢃⠀⠀⠘⣿⣿⣿⣿⣿⣿⡧⢸⣿⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡘⠀⠀⡇⠀⡇⢸⠀⠀⡃⠀⡇⢸⠀⢸⠀⠀⠀⢹⣿⣿⣿⣿⣿⡗⠨⣿⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡅⠀⠀⢸⠀⠀⢸⠀⠀⠀⠀⡇⠈⠀⠀⡇⠀⠀⠀⢿⣿⣿⣿⣿⡏⠀⣿⡀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⠀⠀⠘⠀⠀⡇⠀⠀⢰⠀⢡⠀⠀⠀⢃⠀⠀⠀⠘⣿⣿⣿⣿⠇⠀⢿⡇
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⠀⠀⠀⡄⠀⡇⠀⠀⢰⠀⠈⠀⠀⠀⢸⠀⠀⠀⠀⢸⣿⣿⡟⠀⠀⢸⡇
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⠀⠀⠀⡇⠀⡇⠀⠀⠸⠀⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⣿⣿⡇⠀⠀⢸⡇
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⠀⠀⠀⢃⢠⠃⠀⠀⠀⡇⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⣿⣿⠁⠀⠀⢸⠃
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢢⠀⠀⠀⢈⢰⠀⠀⠀⠀⢱⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⣿⡏⠀⠀⠀⢸⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠀⠀⠀⠀⢸⠀⠀⠀⠀⠘⡄⠀⠀⠀⢸⠀⠀⠀⠀⠀⡟⠀⠀⠀⠀⢸⡀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⡇⢀⠀⠀⢸⠀⠀⠀⠀⢰⠃⠀⠀⠀⠀⣿⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⡇⠀⠀⠀⢸⠀⠀⠀⠀⠀⠸⠀⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡏⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠇⠀⠀⠀⢸⠀⠀⠀⠀⠀⢸⠀⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⠁⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⠀⠀⠀⢸⠀⠀⠀⠀⠀⠀⡆⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠞⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠀⠀⠀⠰⡆⠀⠀⠀⠀⠀⡇⠀⠀⢠⡃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡆⠀⠀⠀⡇⠀⠀⠀⠀⢀⠇⣀⠀⢀⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠇⠀⠀⠀⢳⠀⠀⠀⠀⢸⡇⢁⣀⢹⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠀⠀⠰⢸⠀⠀⠀⠀⢠⣷⠿⠛⢿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⢀⣤⣤⣄⡇⠀⠀⠀⢠⠏⠀⠀⠈⢻⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⡟⠉⠀⠛⡏⠀⠀⠀⣘⣀⡤⡤⠤⢄⣷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢹⡄⠀⠀⠀⢣⡀⠀⠀⣿⠓⠛⠉⠉⠉⠚⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣿⣶⠾⠿⠿⠿⢧⡀⠀⣿⣄⢼⣰⡴⣦⡿⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣏⠠⡐⢄⢢⡰⣆⣴⠀⠀⠉⠛⠛⠟⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠁⠙⠛⠛⠒⠛⠛⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀*/
#include <bits/stdc++.h>
//#pragma GCC optimize("O3,unroll-loops")
//#pragma GCC target("avx,avx2,bmi,bmi2,popcnt,lzcnt")
//#pragma comment(linker, "/STACK:367772160")
using namespace std;
#define all(a) (a).begin(), (a).end()
#define endl "\n"
#define vec vector
#define pii pair<int, int>
#define se second
#define fi first
#define pb push_back
#define maxel(v) *max_element(v.begin(), v.end())
#define minel(v) *min_element(v.begin(), v.end())
#define yes cout << "YES\n";
//#define m1 cout << "-1\n";
#define no cout << "NO\n";
//using i128 = __int128;
typedef long long ll;
typedef unsigned long long ull;
typedef long double ld;
const ll mod = 1e9 + 7;
const ll mod2 = 1e9 + 9;
const ll mod3 = 998244353;
const double pi = 3.141592653589793238;
const long double EPS = 1e-9;
const int maxn = 200000 + 5;
#define DEBUG 1
#if DEBUG
#define del cout << '\n'
#define debug(...) _debug(#__VA_ARGS__, __VA_ARGS__)
template <class X, class Y>
ostream& operator<<(ostream& os, pair<X, Y> const& p) {
    return os << "(" << p.first << ", " << p.second << ")";
}
template <class Ch, class Tr, class Container>
basic_ostream<Ch, Tr>& operator<<(basic_ostream<Ch, Tr>& os, Container const& x) {
    int i = 0, n = (int)distance(x.begin(), x.end());
    os << "{ ";
    for (const auto& y : x) os << y << (++i < n ? ", " : "");
    return os << " }";
}
template <typename... Args>
void _debug(const char* s, Args&&... args) {
    cout << "{ ";
    size_t i = 0, cnt = 0, n = sizeof...(args);
    auto next = [&]() {
        while (s[i] && (s[i] == ' ' || s[i] == ',')) ++i;
        size_t st = i;
        while (s[i] && s[i] != ',') ++i;
        return string(s + st, i - st);
    };
    auto dummy = {(cout << next() << ": " << args << (++cnt < n ? ", " : ""), 0)...};
    (void)dummy;
    cout << " }" << '\n';
}
#else
#define del
#define debug(...)
#endif

template <typename T>
ostream& operator<< (ostream &os, const pair<T, T>& a){
    return os << a.fi << " " << a.se;
}
template <typename T>
istream& operator>> (istream& in, pair<T, T>& a){
    in >> a.fi >> a.se;
    return in;
}
template <typename T>
ostream& operator<< (ostream &os, const vector<T>& a){
    for (int x : a) os << x << " ";
    return os;

}
template <typename T>
istream& operator>> (istream& in, vector<pair<T, T>>& a){
    for (pair<int, int>& x : a) in >> x.fi >> x.se;
    return in;
}
template <typename T>
ostream& operator<< (ostream &os, const vector<pair<T, T>>& a){
    for (pair<int, int> x : a) os << x.fi << " " << x.se << endl;
    return os;

}
template <typename T>
istream& operator>> (istream& in, vector<T>& a){
    for (int& x : a) in >> x;
    return in;
}
template <typename T>
ostream& operator<< (ostream &os, const set<T>& a){
    for (int x : a) os << x << " ";
    return os;
}
template <typename T>
ostream& operator<< (ostream &os, const map<T, T>& a){
    for (pair<int, int> x : a) os << x.fi << " " << x.se << endl;
    return os;
}
template <typename T>
void printrb(vector<T>* rb, int n) {
    for (int u = 0; u < n; ++u) {
        for (const T& v : rb[u]) {
            cout << u << " -> " << v << '\n';
        }
    }
}
template <typename T>
void print2d(const vec<vec<T>> &vec2) {
    for (const auto &row : vec2) {
        for (const auto &i : row) {
            cout << i << " ";
        }
        cout << endl;
    }
}
/* im not sure about full solve so go on subtasks

im doing dsu but smth is wrong 
we r getting 10/100 lol

to get 50 we will take subtasks ! 
got furmula:
sum(f(z)) = sum(ci * 2^(k - fi)) 
lest try

i will brute 1
*/

int nmax;
vec<ll> col;
vec<int> puf;
ll pw2[65];
struct plan
{
	ll d,c;
	int x, y;
};
int getp(int v) {
	if (v > nmax) return v;
	if (puf[v] == v) return v;
	return puf[v] = getp(puf[v]);
}

ll solve_n1(int q, ll k, vec<ll> &d, vec<ll> &c) {
    vec<int> ord(q);
    for (int i = 0; i < q; i++) ord[i]=i;
    sort(all(ord), [&](int i, int j){
        return d[i] < d[j];
    });
    vec<int>f(q, 0);
    vec<pii> groups, ng;
    groups.pb({0, q});
    for (int bit = k - 1; bit>= 0; bit--) {
        ng.clear();
        for (auto& g : groups) {
            int l = g.fi, r = g.se;
            int p =l;
            while (p < r && (((d[ord[p]] >> bit) & 1) == 0)) p++;
            int l0 = 0, r0 = p;
            int l1 = p, r1 = r;
            if (l1 < r0 && l1 < r1) {
                for (int t = l; t < r; t++) f[ord[t]]++;
            }
            if (l0 < r0) ng.pb({l0,r0});
            if (l1 < r1) ng.pb({l1, r1});
        }
        groups.swap(ng);
    }
    ll ans = 0;
    for (int i = 0; i < q; i++) {
        int e = (int)k - f[i];
        if (e < 0) e = 0;
        ll cntz = pw2[e];
        ll add = (c[i] % mod + mod) % mod;
        add = add * cntz % mod;
        ans += add;
        if (ans >= mod) ans -= mod;
    }
    return ans;
}

ll brute_small(int n, ll k, int q, vec<plan> &a) {
    ll lim = 1;
    if (k >= 60) return 0;
    lim = 1LL << k;
    nmax = n;
    col.assign(n + 3, 0);
    puf.assign(n + 3, 0);
    vec<int> ord(q);
    ll ans = 0;
    for (ll z = 0; z < lim; z++) {
        for (int i = 0; i <= n + 1; i++) {
            col[i] = 0;
            puf[i] = i;
        }
        for (int i = 0; i < q; i++) ord[i] = i;
        sort(all(ord), [&](int i, int j){
            return (a[i].d ^ z) < (a[j].d ^ z);
        });
        for (int it = q - 1; it >= 0; it--) {
            int id = ord[it];
            int l = a[id].x;
            int r = a[id].y;
            ll c = a[id].c;
            int pos = getp(l);
            while (pos <= r) {
                col[pos] = (c % mod+ mod) % mod;
                puf[pos] = getp(pos + 1);
                pos = getp(pos);
            }
        }
        ll cur = 0;
        for (int i = 1; i <= n; i++) {
            cur += col[i];
            if (cur >= mod) cur -= mod;
        }
        ans += cur;
        if (ans >= mod) ans -= mod;
    }
    return ans % mod;
}
int main(){
    pw2[0] = 1;
    for (int i = 1; i <= 60; i++) pw2[i] = (pw2[i - 1] * 2) % mod;
    cin.tie(0);
    cout.tie(0);
    ios_base::sync_with_stdio(0);
    int t; cin >> t;
    while (t--) {
    	int n, q;
        ll k;
        cin >> n >> k >> q;
        vec<plan> a(q);
        for (int i = 0; i < q; i++) {
            cin >> a[i].d >> a[i].x >> a[i].y >> a[i].c;
        }

        if (n == 1) {
            vec<ll> d(q), c(q);
            for (int i = 0; i < q; i++) {
                d[i] = a[i].d;
                c[i] = a[i].c;
            }
            ll res = solve_n1(q, k, d, c);
            cout << res % mod << endl;
            continue;
        }

        bool small = false;
        if (k <= 15) {
            ll lim = 1LL << k;
            if (lim * (ll)q <= 5000000) small = true;
        }

        if (small) {
            ll res = brute_small(n, k, q, a);
            cout << res % mod << endl;
        } else {
            cout << 0 << endl;
        }
    }
}
    